on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Create .env.production
        run: |
          echo "VITE_CATALOG_BASE_URL=${{ secrets.VITE_CATALOG_BASE_URL }}" >> .env.production
          echo "VITE_CATALOG_API_KEY=${{ secrets.VITE_CATALOG_API_KEY }}" >> .env.production
          echo "VITE_AUTH0_AUDIENCE=${{ secrets.VITE_AUTH0_AUDIENCE }}" >> .env.production
          echo "VITE_AUTH0_DOMAIN=${{ secrets.VITE_AUTH0_DOMAIN }}" >> .env.production
          echo "VITE_AUTH0_CLIENT_ID=${{ secrets.VITE_AUTH0_CLIENT_ID }}" >> .env.production
          echo "VITE_AUTH0_REDIRECT=${{ secrets.VITE_AUTH0_REDIRECT }}" >> .env.production
          echo "AI_LLM_BASEURL=${{ secrets.AI_LLM_BASEURL }}" >> .env.production
          echo "AI_LLM_API_KEY=${{ secrets.AI_LLM_API_KEY }}" >> .env.production
          echo "AI_LLM_MODEL=${{ secrets.AI_LLM_MODEL }}" >> .env.production
          echo "AI_LLM_ENDPOINT=${{ secrets.AI_LLM_ENDPOINT }}" >> .env.production

      - name: Install Node dependencies
        run: npm install

      - name: Install PHP dependencies
        run: composer install --no-dev --optimize-autoloader
